<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>File Manipulator</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <h1 class="greenFont">File Manipulator</h1>
    <div class="filepicker">
      <button id="upload-btn" class="px-3 py-2 text-green-600 transition-colors rounded-md outline outline-2 bg-slate-950 hover:bg-slate-900 outline-green-900 min-w-[6rem]">Upload File</button>
      <span id="fileNameSpan"></span>
    </div>

    <h3 class="greenFont">Original File Data</h3>
    <div class="file_details">
      <label>Text Value: </label>
      <input type="text" id="original_text_value" readonly />

      <label>Creation Date: </label>
      <input type="text" id="original_creation_date" readonly />

      <label>Last Changed Date: </label>
      <input type="text" id="original_last_changed_date" readonly />

      <label>Last Used Date: </label>
      <input type="text" id="original_last_use_date" readonly />
    </div>

    <h3 class="greenFont">Edit your File here</h3>
    <div class="file_details">
      <label>Text Value: </label>
      <input type="text" id="modified_text_value" />

      <label>Creation Date: </label>
      <input type="text" id="modified_creation_date" />

      <label>Last Changed Date: </label>
      <input type="text" id="modified_last_changed_date" />

      <label>Last Used Date: </label>
      <input type="text" id="modified_last_use_date" />
    </div>

    <button id="modify-btn">Modify File</button>

    <script>
      const uploadButton = document.getElementById("upload-btn");
      let creationDate = document.getElementById("original_creation_date");
      let textValue = document.getElementById("original_text_value");
      let lastChanged = document.getElementById("original_last_changed_date");
      let lastUsed = document.getElementById("original_last_use_date");
      let fileNameSpan = document.getElementById("fileNameSpan");

      const modifyButton = document.getElementById("modify-btn");
      let modified_creationDate = document.getElementById(
        "modified_creation_date"
      );
      let modified_textValue = document.getElementById("modified_text_value");
      let modified_lastChanged = document.getElementById(
        "modified_last_changed_date"
      );
      let modified_lastUsed = document.getElementById("modified_last_use_date");

      async function updateLastEdited(filePath) {
        const now = new Date("1980-01-01");
        await fs.utimes(filePath, now, now);
      }

      uploadButton.addEventListener("click", () => {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = ".txt,.jpg,.png,.gif";

        input.addEventListener("change", () => {
          const file = input.files[0];

          fileNameSpan.textContent = file.name;
          window.api.send("originalFile", file.path);

          window.api.receiveOnce("originalFileReply", (data) => {
            console.log("Recieved: ", data);
            lastUsed.value = data.lastUsed;
            creationDate.value = data.creationDate;
            lastChanged.value = data.lastChanged;
            textValue.value = data.textValue;
          });
        });
        input.click();
      });

      modifyButton.addEventListener("click", () => {
        const modifiedFiles = {};

        if (modified_textValue.value && modified_textValue.value.length) {
          modifiedFiles.textValue = modified_textValue.value;
        }

        if (modified_creationDate.value && modified_creationDate.value.length) {
          modifiedFiles.creationDate = new Date(modified_creationDate.value);
        }

        if (modified_lastChanged.value && modified_lastChanged.value.length) {
          modifiedFiles.lastChanged = new Date(modified_lastChanged.value);
        }

        if (modified_lastUsed.value && modified_lastUsed.value.length) {
          modifiedFiles.lastUsed = new Date(modified_lastUsed.value);
        }

        window.api.send("modifiedFiles", modifiedFiles);
      });
    </script>
  </body>
</html>
